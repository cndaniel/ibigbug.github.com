<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>
Node.js 和 express.js初体验 -
 8D is Here</title>
        <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1">
        <link media="all" rel="stylesheet" href="/static/default/css/reset.css" type="text/css" />
        <link media="all" rel="stylesheet" href="/static/default/css/typo.css" type="text/css" />
        <link media="all" rel="stylesheet" href="/static/default/css/style.css" type="text/css" />
    </head>
    <body>
        <header id="header">
            <h1 class="brand"><a href="/">8D is Here</a></h1>
            <nav id="nav">
                <ul class="fn-clear">
                    <li class="fn-left">
                    <a class="nav-home" href="/">Home</a>
                    </li>
                    
                    <li class="fn-left">
                    <a class="nav-life" href="/life">Life</a>
                    </li>
                    
                    <li class="fn-left">
                    <a class="nav-work" href="/work">Work</a>
                    </li>
                    
                    <li class="fn-left">
                    <a href="/feed.xml">Feed</a>
                    </li>
                </ul>
            </nav>
        </header>
        <div class="wrap typo">
            
<div class="entry">
    <h1 class="entry-title"><a href="/node-and-express.html">Node.Js 和 Express.Js初体验</a></h1>
    <small class="entry-meta">
        Published on
        <time datetime="2013-01-25">2013-01-25</time>
        
        in <a href="/work">Work</a>
        
    </small>
    <div class="entry-content">
        <p>因为前几天有位朋友分手了,要删掉人人网的所有状态.看他在那一条一条点来点去挺麻烦的,何不写个脚本来自动删呢.于是便有了本文.</p>
<p>其实脚本不难写,因为3g.renren.com的登录验证是不麻烦的.返回的html结构也不复杂,请求过程也都很直白,用python的话应该不是什么难题.可是既然node最近这么火,就正好借机会试一下吧.嘿嘿^^.</p>
<p>跟复习专业课一样,学一种新的工具流程也都差不多.无非是:</p>
<ol>
<li>
<p>简单google一下,了解个大概(如果要是专业课复习,就是看一遍目录);</p>
</li>
<li>
<p>如果手册有Overview之类的什么东西抄一份(看一遍例题);</p>
</li>
<li>
<p>开始写,过程中多翻手册,如果不赶时间,最后把手册粗略的过一遍,做到对工具支持的特性心中有数(做题,看书,记公式);</p>
</li>
<li>
<p>重复3.</p>
</li>
</ol>
<p>唉写到这里又不免感叹我这个学渣的悲哀TT,可是无论如何,既然生命要继续,我还是要把东西写完.</p>
<p>Node是什么我就不抄百科了.Express就是Node平台下面的一个web框架.对应起来就像Tornado是Python的一个web框架一样.但又不完全等价:因为Python是一门语言,而Node是一个平台,跑的是喜闻乐见的JavaScript语言,用的Google的V8引擎.</p>
<p>因为Node是以异步出名的,所以刚开始上手的时候真是有点不习惯.比如从数据库读一个User,然后渲染到前台.如果是在python里面,只要依次执行两个函数就好了.可是到这里,我前台页面都渲染完了,控制台显示User还没读出来(当然是夸张了,不过应该是这个道理).没错,要用回调的方式来解决了.至于具体的解决方案和手册教程,网上的前辈们早已总结好了.随便一搜就搜得到.</p>
<p>对Node大概有个了解之后,就开始之前提到的那个脚本.这里采用了Express.js+jsdom+request三个库来处理,除了jsdom这个库有memory leak的bug之外,这个bug我要mark一下,因为当时是部署到heroku的,采集状态不一会程序就crash了- =.log里面显示的是定位到jsdom那一行内存不足了(开始完全想不到会是这个库的问题,以为Node的性能好差啊,随便写个类爬虫应用就内存不足),后来网上搜了搜,好多人有同样的问题,就是要在jsdom的任务执行完毕之后用<code>window.close()</code>来关掉对应的env(其实看起来也不算是bug了,使用不得当而已),其他过程都问题不大,按照手册按部就班把这个小应用写了出来.放到了鄙人的<a href="https://github.com/ibigbug/nodetest">github</a>上面了.</p>
<p>不过还是遗留了一个问题就是:目前的状态采集和处理操作是顺序执行的(这个专业词叫什么来着我给搞忘记了),也就是说目前,在采集的时候,程序是阻塞掉的,不能同时删除.也是网上简单搜了一下,因为node的是异步执行的所以不用多线程的概念还是怎么回事.反正要把采集和处理能够并行执行才好,不知道node在这个问题上一般是怎么处理.改天再研究一下好了.记得好像是可以用setTimeout来避免主线程被阻塞掉的,但是setTimeout的原理看过又给搞忘记了,改天再翻下书好了.</p>
<p>嗯嗯就这样了要睡觉去了好困啊...</p>
    </div>
    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'heheblog';
        var disqus_title = 'Node.js 和 express.js初体验';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    
</div>

            <div class="end">&#10084;</div>
        </div>
        <footer id="footer">
            <small>Copyright by <a class="copyright" href="http://blog.xiaoba.me">8D IS HERE</a> | Powered by <a href="https://github.com/ibigbug/sblog">SBlog</a></small>
        </footer>
        
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-20201958-3']);
            _gaq.push(['_trackPageview']);
            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
        
        <link href='http://fonts.googleapis.com/css?family=Strait&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

    </body>
</html>